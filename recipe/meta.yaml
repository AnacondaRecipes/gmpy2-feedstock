{% set name = "gmpy2" %}
{% set version = "2.2.2" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://pypi.io/packages/source/{{ name[0] }}/{{ name }}/{{ name }}-{{ version }}.tar.gz
  sha256: d9b8c81e0f5e1a3cabf1ea8d154b29b5ef6e33b8f4e4c37b3da957b2dd6a3fa8
  patches:
    #Adjust to_bytes() behavior to match CPython
    # see # https://github.com/aleaxit/gmpy2/pull/593
    - 593.patch

build:
  number: 0
  skip: True  # [py<37]
  script: {{ PYTHON }} -m pip install -vv --no-deps --no-build-isolation .

requirements:
  build:
    - {{ stdlib('c') }}
    - {{ compiler('cxx') }}
  host:
    - python
    - pip
    - setuptools >=61
    - wheel
    # C deps from https://github.com/aleaxit/gmpy/blob/v2.2.1/INSTALL#L10
    - gmp {{ gmp }}
    - mpfr {{ mpfr }}
    - mpc {{ mpc }}
  run:
    - python

test:
  imports:
    - gmpy2
    - gmpy2.gmpy2
  requires:
    - pip
    - pytest
    - hypothesis
    - cython
    - mpmath
  source_files:
    - test
  commands:
    - pip check
    - pytest -v test
  downstreams:
    # Additional testing with a downstream package sympy
    - sympy

about:
  home: https://pypi.org/pypi/gmpy2
  license: LGPL-3.0-or-later
  license_family: LGPL
  license_file: COPYING.LESSER
  summary: "gmpy2 interface to GMP, MPFR, and MPC for Python 3.7+"
  description: gmpy2 is a C-coded Python extension module that supports multiple-precision arithmetic. It is the
    successor to the original gmpy module (supported only the GMP library). gmpy2 adds support for the MPFR
    (correctly rounded real floating-point arithmetic) and MPC (correctly rounded complex floating-point arithmetic)
    libraries.
  dev_url: https://github.com/aleaxit/gmpy
  doc_url: https://gmpy2.readthedocs.io/

extra:
  recipe-maintainers:
    - isuruf
